/* -- do not edit following lines - START --
{
  "expert": true,
  "debug": false,
  "verbose": false
}
-- do not edit previous lines - END --*/
const WARMWATER_STRATEGY = Object.freeze({
    HEATPUMP_GREEDY : "HEATPUMP GREEDY", // Default: EMI on all day, use surplus early as available and do not consider excess
    HEATPUMP_ECONOMIC : "HEATPUMP ECONOMIC", // No boost at all, let it run run to minimal temperature
    EXCESS_ONLY : "EXCESS ONLY", // Only use excess solar energy (via Boiler load) to make warm water, no Heat Pump
    HYBRID : "HYBRID", // Use Heatpump for minimal temperature, then boost opportunistically with excess solar
});

class HeatPumpManager{
    constructor(root_obj, pv_forecast, boiler) {
        this.root_obj = root_obj + ".heatpump";
        this.pv_forecast = pv_forecast;
        this.boiler = boiler;

        console.log("Initialized HeatPumpManager.");

        this.boosted_water_temp_obj = 'stiebel-isg.0.settings.ENERGIEMANAGEMENT.val60312';/*Obere warmwasser solltemp*/
        this.boosted_heating_temp_obj = 'stiebel-isg.0.settings.ENERGIEMANAGEMENT.val60310';/*Obere raum/puffertemp  hk1*/
        this.emi_active = 'stiebel-isg.0.settings.ENERGIEMANAGEMENT.val60302';

        

        this.BOILER_POWER = 4000;
        this.setBoostedValues();
    }

    getEnergyRequired(target_temperature) {
        var temperature_diff = target_temperature - this.boiler.getTemperature();
        if(temperature_diff < 0) {
            temperature_diff = 0;
        }

    }
    
    setBoostedValues() {
        setState(this.boosted_water_temp_obj, 53);
        setState(this.boosted_heating_temp_obj, 48);
        setState(this.emi_active, 1);
        console.log("Setting boosted values (EMI on).");
    }
    setDefaultValues() {
        setState(this.boosted_water_temp_obj, 53);
        setState(this.boosted_heating_temp_obj, 45);
        setState(this.emi_active, 1);
        console.log("Setting default values (EMI on).");
    }
    setEconomicValues() {
        setState(this.boosted_water_temp_obj, 40);
        setState(this.boosted_heating_temp_obj, 35);
        setState(this.emi_active, 1);
        console.log("Setting economic values (EMI on).");
    }
    setMinimalValues() {
        setState(this.boosted_water_temp_obj, 40);
        setState(this.boosted_heating_temp_obj, 35);
        setState(this.emi_active, 0);
        console.log("Setting to minimal values (EMI off).");
    }
    updateAtNoon() {
        this.setBoostedValues();
    }
    updateAtSunrise() {
        if(this.pv_forecast.estimateRemainingExcessToday(this.BOILER_POWER) > 2*60) {
            this.setMinimalValues();
        } else {
            this.setDefaultValues();
        }
    }
    updateHourly() {
      
    }
}
